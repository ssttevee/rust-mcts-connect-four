var app=function(){"use strict";function e(){}function t(e,t){for(const n in t)e[n]=t[n];return e}function n(e){return e()}function r(){return Object.create(null)}function o(e){e.forEach(n)}function c(e){return"function"==typeof e}function s(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function i(e,t,n){const r=t.subscribe(n);e.$$.on_destroy.push(r.unsubscribe?()=>r.unsubscribe():r)}function l(e,t,n){e.insertBefore(t,n||null)}function a(e){e.parentNode.removeChild(e)}function u(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function d(e){return document.createElement(e)}function h(e){return document.createTextNode(e)}function m(){return h(" ")}function g(){return h("")}function f(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}function v(e,t,n){null==n?e.removeAttribute(t):e.setAttribute(t,n)}let p;function b(e){p=e}function $(){const e=p;return(t,n)=>{const r=e.$$.callbacks[t];if(r){const o=function(e,t){const n=document.createEvent("CustomEvent");return n.initCustomEvent(e,!1,!1,t),n}(t,n);r.slice().forEach(t=>{t.call(e,o)})}}}const _=[],w=[],k=[],y=[],x=Promise.resolve();let E=!1;function C(e){k.push(e)}function N(){const e=new Set;do{for(;_.length;){const e=_.shift();b(e),j(e.$$)}for(;w.length;)w.pop()();for(let t=0;t<k.length;t+=1){const n=k[t];e.has(n)||(n(),e.add(n))}k.length=0}while(_.length);for(;y.length;)y.pop()();E=!1}function j(e){e.fragment&&(e.update(e.dirty),o(e.before_update),e.fragment.p(e.dirty,e.ctx),e.dirty=null,e.after_update.forEach(C))}const L=new Set;let H;function M(){H={r:0,c:[],p:H}}function S(){H.r||o(H.c),H=H.p}function A(e,t){e&&e.i&&(L.delete(e),e.i(t))}function G(e,t,n,r){if(e&&e.o){if(L.has(e))return;L.add(e),H.c.push(()=>{L.delete(e),r&&(n&&e.d(1),r())}),e.o(t)}}function O(e,n){const r=n.token={};function o(e,o,c,s){if(n.token!==r)return;n.resolved=c&&{[c]:s};const i=t(t({},n.ctx),n.resolved),l=e&&(n.current=e)(i);n.block&&(n.blocks?n.blocks.forEach((e,t)=>{t!==o&&e&&(M(),G(e,1,1,()=>{n.blocks[t]=null}),S())}):n.block.d(1),l.c(),A(l,1),l.m(n.mount(),n.anchor),N()),n.block=l,n.blocks&&(n.blocks[o]=l)}if((c=e)&&"object"==typeof c&&"function"==typeof c.then){if(e.then(e=>{o(n.then,1,n.value,e)},e=>{o(n.catch,2,n.error,e)}),n.current!==n.pending)return o(n.pending,0),!0}else{if(n.current!==n.then)return o(n.then,1,n.value,e),!0;n.resolved={[n.value]:e}}var c}function P(e,t,r){const{fragment:s,on_mount:i,on_destroy:l,after_update:a}=e.$$;s.m(t,r),C(()=>{const t=i.map(n).filter(c);l?l.push(...t):o(t),e.$$.on_mount=[]}),a.forEach(C)}function I(e,t){e.$$.fragment&&(o(e.$$.on_destroy),e.$$.fragment.d(t),e.$$.on_destroy=e.$$.fragment=null,e.$$.ctx={})}function T(e,t){e.$$.dirty||(_.push(e),E||(E=!0,x.then(N)),e.$$.dirty=r()),e.$$.dirty[t]=!0}function z(t,n,c,s,i,l){const a=p;b(t);const u=n.props||{},d=t.$$={fragment:null,ctx:null,props:l,update:e,not_equal:i,bound:r(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(a?a.$$.context:[]),callbacks:r(),dirty:null};let h=!1;var m;d.ctx=c?c(t,u,(e,n)=>{d.ctx&&i(d.ctx[e],d.ctx[e]=n)&&(d.bound[e]&&d.bound[e](n),h&&T(t,e))}):u,d.update(),h=!0,o(d.before_update),d.fragment=s(d.ctx),n.target&&(n.hydrate?d.fragment.l((m=n.target,Array.from(m.childNodes))):d.fragment.c(),n.intro&&A(t.$$.fragment),P(t,n.target,n.anchor),N()),b(a)}class q{$destroy(){I(this,1),this.$destroy=e}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(){}}function B(e,t){return{subscribe:V(e,t).subscribe}}function V(t,n=e){let r;const o=[];function c(e){if(s(t,e)){if(t=e,!r)return;o.forEach(e=>e[1]()),o.forEach(e=>e[0](t))}}return{set:c,update:function(e){c(e(t))},subscribe:function(s,i=e){const l=[s,i];return o.push(l),1===o.length&&(r=n(c)||e),s(t),()=>{const e=o.indexOf(l);-1!==e&&o.splice(e,1),0===o.length&&(r(),r=null)}}}}const W=(()=>{let e;return async function(){return e||(e=new Promise((t,n)=>{const r=new Worker("mcts.js"),o=()=>{e=null,n(new Error("failed to initialize worker"))};r.addEventListener("message",c=>{r.removeEventListener("error",o),c.data.error?(e=null,n(c.data.error)):t(e=function(e){let t={};return e.addEventListener("message",e=>{const{id:n,result:r,error:o}=e.data;if(!(n in t))return;const{resolve:c,reject:s}=t[n];delete t[n],o?s(o):c(r)}),e.addEventListener("error",e=>{const n=t;t={},Object.values(n).map(({reject:t})=>t(e))}),{send(n,r){let o;for(;(o=Math.random().toString().slice(2))&&o in t;);return new Promise((c,s)=>{t[o]={resolve:c,reject:s},e.postMessage({id:o,name:n,payload:r})})}}}(r))}),r.addEventListener("error",o)}))}})(),D=Symbol("Player 1"),F=Symbol("Player 2");function J(e){return e.map(e=>e.map(e=>0===e?D:1===e?F:null))}class K extends Event{constructor(e){super("moveschanged"),this.moves=e}}class Q extends Event{constructor(e){super("boardchanged"),this.board=e}}class R extends Event{constructor(e,t){super("gameover"),this.winner=e,this.cells=t}}class U extends EventTarget{static async create(e={}){const t=await W();return new U(t,await t.send("newGame",e))}constructor(e,{id:t,cols:n,rows:r,moves:o,board:c}){super(),this.__worker=e,this.__id=t,this.__cols=n,this.__rows=r,this.__moves=o,this.__board=J(c),this.__lastMove=null,this.__over=!1}get validMoves(){return this.__moves}get board(){return this.__board}get cols(){return this.__cols}get rows(){return this.__rows}get over(){return this.__over}async drop(e){if(this.__over)throw new Error("game is already over");const{cell:t,over:n,cells:r,moves:o,board:c}=await this.__worker.send("drop",{gameId:this.__id,column:e});return this.dispatchEvent(new Q(this.__board=J(c))),(this.__over=n)?(this.dispatchEvent(new K(this.__moves=[])),this.dispatchEvent(new R(r?this.__board[t[0]][t[1]]:null,r)),await this.__worker.send("freeGame",{gameId:this.__id})):this.__moves.length!==o.length&&this.dispatchEvent(new K(this.__moves=o)),t}async bestMove(e){if(this.__over)throw new Error("game is already over");return(await this.__worker.send("think",{gameId:this.__id,duration:e})).reduce((e,[t,n])=>!e||e[1]<n?[t,n]:e,null)[0]}}function X(e,t,n){const r=Object.create(e);return r._=t[n],r.col=n,r}function Y(e,t,n){const r=Object.create(e);return r.row=t[n],r}function Z(e){var t,n,r;function c(){return e.click_handler(e)}function s(){return e.mouseover_handler(e)}return{c(){v(t=d("td"),"class",n=(e.hovered_column==e.col?"hovered":"")+" "+(e.isHighlighted(e.col,e.row)?"highlighted":"")+" "+e.cellClass(e.col,e.row)+" svelte-vlput1"),r=[f(t,"click",c),f(t,"mouseover",s)]},m(e,n){l(e,t,n)},p(r,o){e=o,(r.hovered_column||r.rows)&&n!==(n=(e.hovered_column==e.col?"hovered":"")+" "+(e.isHighlighted(e.col,e.row)?"highlighted":"")+" "+e.cellClass(e.col,e.row)+" svelte-vlput1")&&v(t,"class",n)},d(e){e&&a(t),o(r)}}}function ee(e){for(var t,n,r={length:e.cols},o=[],c=0;c<r.length;c+=1)o[c]=Z(X(e,r,c));return{c(){t=d("tr");for(var e=0;e<o.length;e+=1)o[e].c();n=m()},m(e,r){l(e,t,r);for(var c=0;c<o.length;c+=1)o[c].m(t,null);!function(e,t){e.appendChild(t)}(t,n)},p(e,c){if(e.hovered_column||e.isHighlighted||e.rows||e.cellClass||e.cols){r={length:c.cols};for(var s=0;s<r.length;s+=1){const i=X(c,r,s);o[s]?o[s].p(e,i):(o[s]=Z(i),o[s].c(),o[s].m(t,n))}for(;s<o.length;s+=1)o[s].d(1);o.length=r.length}},d(e){e&&a(t),u(o,e)}}}function te(t){for(var n,r,o=[...Array(t.rows).keys()].reverse(),c=[],s=0;s<o.length;s+=1)c[s]=ee(Y(t,o,s));return{c(){n=d("table");for(var e=0;e<c.length;e+=1)c[e].c();r=f(n,"mouseout",t.mouseout_handler)},m(e,t){l(e,n,t);for(var r=0;r<c.length;r+=1)c[r].m(n,null)},p(e,t){if(e.cols||e.hovered_column||e.isHighlighted||e.rows||e.cellClass){o=[...Array(t.rows).keys()].reverse();for(var r=0;r<o.length;r+=1){const s=Y(t,o,r);c[r]?c[r].p(e,s):(c[r]=ee(s),c[r].c(),c[r].m(n,null))}for(;r<c.length;r+=1)c[r].d(1);c.length=o.length}},i:e,o:e,d(e){e&&a(n),u(c,e),r()}}}function ne(e,t,n){const r=$();function o(e){r("clickcolumn",e)}let{cols:c,rows:s,board:i,moves:l,disabled:a,highlight:u}=t,d=null;function h(e){return!a&&l.includes(e)}return e.$set=(e=>{"cols"in e&&n("cols",c=e.cols),"rows"in e&&n("rows",s=e.rows),"board"in e&&n("board",i=e.board),"moves"in e&&n("moves",l=e.moves),"disabled"in e&&n("disabled",a=e.disabled),"highlight"in e&&n("highlight",u=e.highlight)}),{clickColumn:o,cols:c,rows:s,board:i,moves:l,disabled:a,highlight:u,hovered_column:d,isValidColumn:h,isHighlighted:function(e,t){return u.some(([n,r])=>n==e&&t==r)},cellClass:function(e,t){switch(i[e][t]){case D:return"player-1";case F:return"player-2"}return"empty"},click_handler:function({col:e}){return h(e)&&o(e)},mouseover_handler:function({col:e}){const t=d=h(e)?e:null;return n("hovered_column",d),t},mouseout_handler:function(){const e=d=null;return n("hovered_column",d),e}}}class re extends q{constructor(e){super(),z(this,e,ne,te,s,["cols","rows","board","moves","disabled","highlight"])}}function oe(e){var t,n=new re({props:{cols:e.game.cols,rows:e.game.rows,board:e.$board,moves:e.$moves,disabled:e.$thinking,highlight:e.$highlight}});return n.$on("clickcolumn",e.columnClickHandler),{c(){n.$$.fragment.c()},m(e,r){P(n,e,r),t=!0},p(e,t){var r={};e.game&&(r.cols=t.game.cols),e.game&&(r.rows=t.game.rows),e.$board&&(r.board=t.$board),e.$moves&&(r.moves=t.$moves),e.$thinking&&(r.disabled=t.$thinking),e.$highlight&&(r.highlight=t.$highlight),n.$set(r)},i(e){t||(A(n.$$.fragment,e),t=!0)},o(e){G(n.$$.fragment,e),t=!1},d(e){I(n,e)}}}function ce(e){var t,n,r=new re({props:{cols:e.game.cols,rows:e.game.rows,board:e.$board,moves:e.$moves,disabled:e.$thinking,highlight:e.$highlight}});return r.$on("clickcolumn",e.columnClickHandler),{c(){r.$$.fragment.c(),t=h("\n    Thinking...")},m(e,o){P(r,e,o),l(e,t,o),n=!0},p(e,t){var n={};e.game&&(n.cols=t.game.cols),e.game&&(n.rows=t.game.rows),e.$board&&(n.board=t.$board),e.$moves&&(n.moves=t.$moves),e.$thinking&&(n.disabled=t.$thinking),e.$highlight&&(n.highlight=t.$highlight),r.$set(n)},i(e){n||(A(r.$$.fragment,e),n=!0)},o(e){G(r.$$.fragment,e),n=!1},d(e){I(r,e),e&&a(t)}}}function se(e){var t,n,r,o,c=[ce,oe],s=[];function i(e){return e.$thinking?0:1}return t=i(e),n=s[t]=c[t](e),{c(){n.c(),r=g()},m(e,n){s[t].m(e,n),l(e,r,n),o=!0},p(e,o){var l=t;(t=i(o))===l?s[t].p(e,o):(M(),G(s[l],1,1,()=>{s[l]=null}),S(),(n=s[t])||(n=s[t]=c[t](o)).c(),A(n,1),n.m(r.parentNode,r))},i(e){o||(A(n),o=!0)},o(e){G(n),o=!1},d(e){s[t].d(e),e&&a(r)}}}const ie=Symbol("nobody");function le(e,t,n){let r,o,c,s,{game:l}=t;const a=$(),u=V(!1);i(e,u,e=>{n("$thinking",r=e)});const d=V([]);i(e,d,e=>{n("$highlight",s=e)});const h=B(l.board,e=>l.addEventListener("boardchanged",t=>e(t.board)));i(e,h,e=>{n("$board",o=e)});const m=B(l.validMoves,e=>l.addEventListener("moveschanged",t=>e(t.moves)));async function g(e){const t=await l.drop(e);return!l.over&&(d.set([t]),!0)}return i(e,m,e=>{n("$moves",c=e)}),l.addEventListener("gameover",e=>{d.set(e.cells||[]),a("gameover",e.winner||ie)}),e.$set=(e=>{"game"in e&&n("game",l=e.game)}),{game:l,thinking:u,highlight:d,board:h,moves:m,columnClickHandler:async function(e){if(!await g(e.detail))return;u.set(!0);const t=await l.bestMove(1e3);try{if(!await g(t))return}finally{u.set(!1)}},$thinking:r,$board:o,$moves:c,$highlight:s}}class ae extends q{constructor(e){super(),z(this,e,le,se,s,["game"])}}function ue(t){var n,r;return{c(){(n=d("p")).textContent="failed to initialize",r=m()},m(e,t){l(e,n,t),l(e,r,t)},p:e,i:e,o:e,d(e){e&&(a(n),a(r))}}}function de(e){var t,n,r,o,c=[me,he],s=[];function i(e){return e.gamep?0:1}return t=i(e),n=s[t]=c[t](e),{c(){n.c(),r=g()},m(e,n){s[t].m(e,n),l(e,r,n),o=!0},p(e,o){var l=t;(t=i(o))===l?s[t].p(e,o):(M(),G(s[l],1,1,()=>{s[l]=null}),S(),(n=s[t])||(n=s[t]=c[t](o)).c(),A(n,1),n.m(r.parentNode,r))},i(e){o||(A(n),o=!0)},o(e){G(n),o=!1},d(e){s[t].d(e),e&&a(r)}}}function he(t){var n,r;return{c(){(n=d("button")).textContent="New Game",r=f(n,"click",t.startNewGame)},m(e,t){l(e,n,t)},p:e,i:e,o:e,d(e){e&&a(n),r()}}}function me(e){var n,r,o;let c={ctx:e,current:null,token:null,pending:pe,then:fe,catch:ge,value:"game",error:"err",blocks:[,,,]};return O(r=e.gamep,c),{c(){n=g(),c.block.c()},m(e,t){l(e,n,t),c.block.m(e,c.anchor=t),c.mount=(()=>n.parentNode),c.anchor=n,o=!0},p(n,o){e=o,c.ctx=e,"gamep"in n&&r!==(r=e.gamep)&&O(r,c)||c.block.p(n,t(t({},e),c.resolved))},i(e){o||(A(c.block),o=!0)},o(e){for(let e=0;e<3;e+=1){G(c.blocks[e])}o=!1},d(e){e&&a(n),c.block.d(e),c.token=null,c=null}}}function ge(t){var n,r;return{c(){(n=d("p")).textContent="failed to start game",r=m()},m(e,t){l(e,n,t),l(e,r,t)},p:e,i:e,o:e,d(e){e&&(a(n),a(r))}}}function fe(e){var t,n,r,o=new ae({props:{game:e.game}});o.$on("gameover",e.gameover_handler);var c=e.winner&&ve(e);return{c(){o.$$.fragment.c(),t=m(),c&&c.c(),n=g()},m(e,s){P(o,e,s),l(e,t,s),c&&c.m(e,s),l(e,n,s),r=!0},p(e,t){var r={};e.gamep&&(r.game=t.game),o.$set(r),t.winner?c?c.p(e,t):((c=ve(t)).c(),c.m(n.parentNode,n)):c&&(c.d(1),c=null)},i(e){r||(A(o.$$.fragment,e),r=!0)},o(e){G(o.$$.fragment,e),r=!1},d(e){I(o,e),e&&a(t),c&&c.d(e),e&&a(n)}}}function ve(e){var t,n,r,o,c,s,i=e.winner.toString();return{c(){t=h(i),n=h(" wins!"),r=d("br"),o=m(),(c=d("button")).textContent="Play Again",s=f(c,"click",e.startNewGame)},m(e,s){l(e,t,s),l(e,n,s),l(e,r,s),l(e,o,s),l(e,c,s)},p(e,n){var r,o;e.winner&&i!==(i=n.winner.toString())&&(o=""+(o=i),(r=t).data!==o&&(r.data=o))},d(e){e&&(a(t),a(n),a(r),a(o),a(c)),s()}}}function pe(t){var n;return{c(){(n=d("p")).textContent="starting game..."},m(e,t){l(e,n,t)},p:e,i:e,o:e,d(e){e&&a(n)}}}function be(t){var n;return{c(){(n=d("p")).textContent="loading..."},m(e,t){l(e,n,t)},p:e,i:e,o:e,d(e){e&&a(n)}}}function $e(e){var n,r,o,c,s;let i={ctx:e,current:null,token:null,pending:be,then:de,catch:ue,value:"_",error:"err",blocks:[,,,]};return O(c=W(),i),{c(){(n=d("h1")).textContent="connect four",r=m(),o=g(),i.block.c()},m(e,t){l(e,n,t),l(e,r,t),l(e,o,t),i.block.m(e,i.anchor=t),i.mount=(()=>o.parentNode),i.anchor=o,s=!0},p(n,r){e=r,i.ctx=e,c!==(c=W())&&O(c,i)||i.block.p(n,t(t({},e),i.resolved))},i(e){s||(A(i.block),s=!0)},o(e){for(let e=0;e<3;e+=1){G(i.blocks[e])}s=!1},d(e){e&&(a(n),a(r),a(o)),i.block.d(e),i.token=null,i=null}}}function _e(e,t,n){let r,o;return{gamep:r,winner:o,startNewGame:function(){n("winner",o=null),n("gamep",r=U.create())},gameover_handler:function(e){const t=o=e.detail;return n("winner",o),t}}}return new class extends q{constructor(e){super(),z(this,e,_e,$e,s,[])}}({target:document.body})}();
//# sourceMappingURL=bundle.js.map
