var app=function(){"use strict";function n(){}function e(n,e){for(const t in e)n[t]=e[t];return n}function t(n){return n()}function r(){return Object.create(null)}function o(n){n.forEach(t)}function c(n){return"function"==typeof n}function u(n,e){return n!=n?e==e:n!==e||n&&"object"==typeof n||"function"==typeof n}function s(n,e){n.appendChild(e)}function i(n,e,t){n.insertBefore(e,t||null)}function l(n){n.parentNode.removeChild(n)}function a(n,e){for(let t=0;t<n.length;t+=1)n[t]&&n[t].d(e)}function f(n){return document.createElement(n)}function d(n){return document.createTextNode(n)}function m(){return d(" ")}function b(){return d("")}function _(n,e,t,r){return n.addEventListener(e,t,r),()=>n.removeEventListener(e,t,r)}function h(n,e,t){null==t?n.removeAttribute(e):n.setAttribute(e,t)}function g(n,e){e=""+e,n.data!==e&&(n.data=e)}let p;function w(n){p=n}function v(n){(function(){if(!p)throw new Error("Function called outside component initialization");return p})().$$.on_destroy.push(n)}function $(){const n=p;return(e,t)=>{const r=n.$$.callbacks[e];if(r){const o=function(n,e){const t=document.createEvent("CustomEvent");return t.initCustomEvent(n,!1,!1,e),t}(e,t);r.slice().forEach(e=>{e.call(n,o)})}}}const y=[],k=[],x=[],A=[],E=Promise.resolve();let j=!1;function O(n){x.push(n)}function N(){const n=new Set;do{for(;y.length;){const n=y.shift();w(n),C(n.$$)}for(;k.length;)k.pop()();for(let e=0;e<x.length;e+=1){const t=x[e];n.has(t)||(t(),n.add(t))}x.length=0}while(y.length);for(;A.length;)A.pop()();j=!1}function C(n){n.fragment&&(n.update(n.dirty),o(n.before_update),n.fragment.p(n.dirty,n.ctx),n.dirty=null,n.after_update.forEach(O))}const S=new Set;let W,I;function U(){W={r:0,c:[],p:W}}function B(){W.r||o(W.c),W=W.p}function L(n,e){n&&n.i&&(S.delete(n),n.i(e))}function M(n,e,t,r){if(n&&n.o){if(S.has(n))return;S.add(n),W.c.push(()=>{S.delete(n),r&&(t&&n.d(1),r())}),n.o(e)}}function R(n,t){const r=t.token={};function o(n,o,c,u){if(t.token!==r)return;t.resolved=c&&{[c]:u};const s=e(e({},t.ctx),t.resolved),i=n&&(t.current=n)(s);t.block&&(t.blocks?t.blocks.forEach((n,e)=>{e!==o&&n&&(U(),M(n,1,1,()=>{t.blocks[e]=null}),B())}):t.block.d(1),i.c(),L(i,1),i.m(t.mount(),t.anchor),N()),t.block=i,t.blocks&&(t.blocks[o]=i)}if((c=n)&&"object"==typeof c&&"function"==typeof c.then){if(n.then(n=>{o(t.then,1,t.value,n)},n=>{o(t.catch,2,t.error,n)}),t.current!==t.pending)return o(t.pending,0),!0}else{if(t.current!==t.then)return o(t.then,1,t.value,n),!0;t.resolved={[t.value]:n}}var c}function P(n){let e;const t=n.subscribe(n=>e=n);return t.unsubscribe?t.unsubscribe():t(),e}function q(n,e,r){const{fragment:u,on_mount:s,on_destroy:i,after_update:l}=n.$$;u.m(e,r),O(()=>{const e=s.map(t).filter(c);i?i.push(...e):o(e),n.$$.on_mount=[]}),l.forEach(O)}function z(n,e){n.$$.fragment&&(o(n.$$.on_destroy),n.$$.fragment.d(e),n.$$.on_destroy=n.$$.fragment=null,n.$$.ctx={})}function D(n,e){n.$$.dirty||(y.push(n),j||(j=!0,E.then(N)),n.$$.dirty=r()),n.$$.dirty[e]=!0}function F(e,t,c,u,s,i){const l=p;w(e);const a=t.props||{},f=e.$$={fragment:null,ctx:null,props:i,update:n,not_equal:s,bound:r(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(l?l.$$.context:[]),callbacks:r(),dirty:null};let d=!1;var m;f.ctx=c?c(e,a,(n,t)=>{f.ctx&&s(f.ctx[n],f.ctx[n]=t)&&(f.bound[n]&&f.bound[n](t),d&&D(e,n))}):a,f.update(),d=!0,o(f.before_update),f.fragment=u(f.ctx),t.target&&(t.hydrate?f.fragment.l((m=t.target,Array.from(m.childNodes))):f.fragment.c(),t.intro&&L(e.$$.fragment),q(e,t.target,t.anchor),N()),w(l)}class T{$destroy(){z(this,1),this.$destroy=n}$on(n,e){const t=this.$$.callbacks[n]||(this.$$.callbacks[n]=[]);return t.push(e),()=>{const n=t.indexOf(e);-1!==n&&t.splice(n,1)}}$set(){}}function Y(e,t=n){let r;const o=[];function c(n){if(u(e,n)){if(e=n,!r)return;o.forEach(n=>n[1]()),o.forEach(n=>n[0](e))}}return{set:c,update:function(n){c(n(e))},subscribe:function(u,s=n){const i=[u,s];return o.push(i),1===o.length&&(r=t(c)||n),u(e),()=>{const n=o.indexOf(i);-1!==n&&o.splice(n,1),0===o.length&&(r(),r=null)}}}}function G(n,e,t){const r=Object.create(n);return r.col=e[t][0],r.row=e[t][1],r.token=e[t][2],r}function J(n,e,t){const r=Object.create(n);return r.cells=e[t],r}function H(n){var e,t=n.token;return{c(){e=d(t)},m(n,t){i(n,e,t)},p(n,r){n.grid&&t!==(t=r.token)&&g(e,t)},d(n){n&&l(e)}}}function K(e){var t;return{c(){t=d("Â ")},m(n,e){i(n,t,e)},p:n,d(n){n&&l(t)}}}function Q(n){var e,t,r;function c(n){return void 0===n.token?K:H}var u=c(n),s=u(n);function a(){return n.click_handler(n)}function d(){return n.mouseover_handler(n)}return{c(){e=f("td"),s.c(),h(e,"class",t=(n.hovered_column==n.col?"highlighted":"")+" svelte-xpf6y2"),r=[_(e,"click",a),_(e,"mouseover",d)]},m(n,t){i(n,e,t),s.m(e,null)},p(r,o){u===(u=c(n=o))&&s?s.p(r,n):(s.d(1),(s=u(n))&&(s.c(),s.m(e,null))),(r.hovered_column||r.grid)&&t!==(t=(n.hovered_column==n.col?"highlighted":"")+" svelte-xpf6y2")&&h(e,"class",t)},d(n){n&&l(e),s.d(),o(r)}}}function V(n){for(var e,t,r=n.cells,o=[],c=0;c<r.length;c+=1)o[c]=Q(G(n,r,c));return{c(){e=f("tr");for(var n=0;n<o.length;n+=1)o[n].c();t=m()},m(n,r){i(n,e,r);for(var c=0;c<o.length;c+=1)o[c].m(e,null);s(e,t)},p(n,c){if(n.hovered_column||n.grid){r=c.cells;for(var u=0;u<r.length;u+=1){const s=G(c,r,u);o[u]?o[u].p(n,s):(o[u]=Q(s),o[u].c(),o[u].m(e,t))}for(;u<o.length;u+=1)o[u].d(1);o.length=r.length}},d(n){n&&l(e),a(o,n)}}}function X(e){for(var t,r,o=e.grid,c=[],u=0;u<o.length;u+=1)c[u]=V(J(e,o,u));return{c(){t=f("table");for(var n=0;n<c.length;n+=1)c[n].c();r=_(t,"mouseout",e.mouseout_handler)},m(n,e){i(n,t,e);for(var r=0;r<c.length;r+=1)c[r].m(t,null)},p(n,e){if(n.grid||n.hovered_column){o=e.grid;for(var r=0;r<o.length;r+=1){const u=J(e,o,r);c[r]?c[r].p(n,u):(c[r]=V(u),c[r].c(),c[r].m(t,null))}for(;r<c.length;r+=1)c[r].d(1);c.length=o.length}},i:n,o:n,d(n){n&&l(t),a(c,n),r()}}}function Z(n,e,t){let r;const o=$();function c(n){o("column",n+1)}let u,s,i,l,{board:a,moves:f,disabled:d}=e;!function(n,e,t){const r=e.subscribe(t);n.$$.on_destroy.push(r.unsubscribe?()=>r.unsubscribe():r)}(n,d,n=>{t("$disabled",r=n)}),v(a.subscribe(n=>{u=n.cols(),s=n.rows(),t("grid",i=Array.from({length:s},(e,t)=>Array.from({length:u},(e,r)=>[r,s-t-1,n.token_at(r,s-t-1)])))}));let m=null;return v(f.subscribe(n=>{t("valid_moves",l=n.map(n=>n-1)),null===m||l.includes(m)||t("hovered_column",m=null)})),n.$set=(n=>{"board"in n&&t("board",a=n.board),"moves"in n&&t("moves",f=n.moves),"disabled"in n&&t("disabled",d=n.disabled)}),{clickColumn:c,board:a,moves:f,disabled:d,grid:i,valid_moves:l,hovered_column:m,$disabled:r,click_handler:function({col:n}){return!r&&l.includes(n)&&c(n)},mouseover_handler:function({col:n}){const e=m=l.includes(n)?n:null;return t("hovered_column",m),e},mouseout_handler:function(){const n=m=null;return t("hovered_column",m),n}}}class nn extends T{constructor(n){super(),F(this,n,Z,X,u,["board","moves","disabled"])}}let en=null;function tn(){return null!==en&&en.buffer===I.memory.buffer||(en=new Int32Array(I.memory.buffer)),en}let rn=null;function on(){return null!==rn&&rn.buffer===I.memory.buffer||(rn=new Uint8Array(I.memory.buffer)),rn}function cn(n){return null==n}let un=null;function sn(){return null!==un&&un.buffer===I.memory.buffer||(un=new Uint32Array(I.memory.buffer)),un}const ln=new Array(32);function an(n){return ln[n]}ln.fill(void 0),ln.push(void 0,null,!0,!1);let fn=ln.length;function dn(n){const e=an(n);return function(n){n<36||(ln[n]=fn,fn=n)}(n),e}function mn(n,e){const t=sn().subarray(n/4,n/4+e),r=[];for(let n=0;n<t.length;n++)r.push(dn(t[n]));return r}function bn(n,e){if(!(n instanceof e))throw new Error(`expected instance of ${e.name}`);return n.ptr}let _n=0;function hn(n){fn===ln.length&&ln.push(ln.length+1);const e=fn;return fn=ln[e],ln[e]=n,e}let gn=new TextDecoder("utf-8");function pn(n,e){return gn.decode(on().subarray(n,n+e))}Object.freeze({Player1:0,Player2:1});class wn{static __wrap(n){const e=Object.create(wn.prototype);return e.ptr=n,e}free(){const n=this.ptr;this.ptr=0,I.__wbg_board_free(n)}token_at(n,e){const t=I.board_token_at(this.ptr,n,e);return 2===t?void 0:t}fill(n,e,t){I.board_fill(this.ptr,n,e,t)}constructor(n,e){const t=I.board_new(n,e);return wn.__wrap(t)}cols(){return I.board_cols(this.ptr)>>>0}rows(){return I.board_rows(this.ptr)>>>0}}class vn{static __wrap(n){const e=Object.create(vn.prototype);return e.ptr=n,e}free(){const n=this.ptr;this.ptr=0,I.__wbg_game_free(n)}over(){return 0!==I.game_over(this.ptr)}current_player(){return I.game_current_player(this.ptr)}cols(){return I.game_cols(this.ptr)>>>0}rows(){return I.game_rows(this.ptr)>>>0}state(){I.game_state(8,this.ptr);const n=tn(),e=(t=n[2],r=n[3],on().subarray(t/1,t/1+r)).slice();var t,r;return I.__wbindgen_free(n[2],1*n[3]),e}board(){const n=I.game_board(this.ptr);return wn.__wrap(n)}constructor(n,e,t){const r=I.game_ctor(!cn(n),cn(n)?0:n,!cn(e),cn(e)?0:e,!cn(t),cn(t)?0:t);return vn.__wrap(r)}valid_moves(){I.game_valid_moves(8,this.ptr);const n=tn(),e=mn(n[2],n[3]).slice();return I.__wbindgen_free(n[2],4*n[3]),e}winner(){const n=I.game_winner(this.ptr);return 2===n?void 0:n}winner_cells(){I.game_winner_cells(8,this.ptr);const n=tn();let e;return 0!==n[2]&&(e=mn(n[2],n[3]).slice(),I.__wbindgen_free(n[2],4*n[3])),e}drop(n){return I.game_drop(this.ptr,n)>>>0}}class $n{static __wrap(n){const e=Object.create($n.prototype);return e.ptr=n,e}free(){const n=this.ptr;this.ptr=0,I.__wbg_mcts_free(n)}constructor(){const n=I.mcts_new();return $n.__wrap(n)}simulate(n){bn(n,vn);I.mcts_simulate(8,this.ptr,n.ptr);const e=tn(),t=mn(e[2],e[3]).slice();return I.__wbindgen_free(e[2],4*e[3]),t}think(n,e){bn(n,vn);I.mcts_think(8,this.ptr,n.ptr,e);const t=tn(),r=mn(t[2],t[3]).slice();return I.__wbindgen_free(t[2],4*t[3]),r}move_weights(n,e){I.mcts_move_weights(8,this.ptr,function(n){const e=I.__wbindgen_malloc(1*n.length);return on().set(n,e/1),_n=n.length,e}(n),_n,function(n){const e=I.__wbindgen_malloc(4*n.length),t=sn();for(let r=0;r<n.length;r++)t[e/4+r]=hn(n[r]);return _n=n.length,e}(e),_n);const t=tn(),r=mn(t[2],t[3]).slice();return I.__wbindgen_free(t[2],4*t[3]),r}}function yn(n){let e;void 0===n&&(n=(document.currentScript&&document.currentScript.src||new URL("bundle.js",document.baseURI).href).replace(/\.js$/,"_bg.wasm"));const t={wbg:{}};if(t.wbg.__wbindgen_number_new=function(n){return hn(n)},t.wbg.__wbindgen_json_parse=function(n,e){return hn(JSON.parse(pn(n,e)))},t.wbg.__wbindgen_string_new=function(n,e){return hn(pn(n,e))},t.wbg.__wbg_random_3d74d328ba8726a5=function(){return Math.random()},t.wbg.__wbg_now_905b1ca2d46dea4e=function(){return Date.now()},t.wbg.__wbindgen_object_drop_ref=function(n){dn(n)},t.wbg.__wbindgen_number_get=function(n,e){const t=an(n);if("number"==typeof t)return t;on()[e]=1;return 0},t.wbg.__wbindgen_throw=function(n,e){throw new Error(pn(n,e))},t.wbg.__wbindgen_rethrow=function(n){throw dn(n)},n instanceof URL||"string"==typeof n||n instanceof Request){const r=fetch(n);e="function"==typeof WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(r,t).catch(n=>(console.warn("`WebAssembly.instantiateStreaming` failed. Assuming this is because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n),r.then(n=>n.arrayBuffer()).then(n=>WebAssembly.instantiate(n,t)))):r.then(n=>n.arrayBuffer()).then(n=>WebAssembly.instantiate(n,t))}else e=WebAssembly.instantiate(n,t).then(e=>e instanceof WebAssembly.Instance?{instance:e,module:n}:e);return e.then(({instance:n,module:e})=>(I=n.exports,yn.__wbindgen_wasm_module=e,I))}function kn(n){var e,t,r,o=new nn({props:{board:n.game.board,moves:n.game.moves,disabled:n.game.thinking}});o.$on("column",n.column_handler);var c=n.winner&&xn(n);return{c(){o.$$.fragment.c(),e=m(),c&&c.c(),t=b()},m(n,u){q(o,n,u),i(n,e,u),c&&c.m(n,u),i(n,t,u),r=!0},p(n,e){var r={};n.game&&(r.board=e.game.board),n.game&&(r.moves=e.game.moves),n.game&&(r.disabled=e.game.thinking),o.$set(r),e.winner?c?c.p(n,e):((c=xn(e)).c(),c.m(t.parentNode,t)):c&&(c.d(1),c=null)},i(n){r||(L(o.$$.fragment,n),r=!0)},o(n){M(o.$$.fragment,n),r=!1},d(n){z(o,n),n&&l(e),c&&c.d(n),n&&l(t)}}}function xn(n){var e,t,r,o;return{c(){e=d(n.winner),t=m(),(r=f("button")).textContent="Back",o=_(r,"click",n.click_handler)},m(n,o){i(n,e,o),i(n,t,o),i(n,r,o)},p(n,t){n.winner&&g(e,t.winner)},d(n){n&&(l(e),l(t),l(r)),o()}}}function An(n){var e,t;return{c(){(e=f("button")).textContent="New Game",t=_(e,"click",n.newgame)},m(n,t){i(n,e,t)},d(n){n&&l(e),t()}}}function En(n){var e,t,r,o=n.game&&kn(n),c=!n.game&&An(n);return{c(){o&&o.c(),e=m(),c&&c.c(),t=b()},m(n,u){o&&o.m(n,u),i(n,e,u),c&&c.m(n,u),i(n,t,u),r=!0},p(n,r){r.game?o?(o.p(n,r),L(o,1)):((o=kn(r)).c(),L(o,1),o.m(e.parentNode,e)):o&&(U(),M(o,1,1,()=>{o=null}),B()),r.game?c&&(c.d(1),c=null):c||((c=An(r)).c(),c.m(t.parentNode,t))},i(n){r||(L(o),r=!0)},o(n){M(o),r=!1},d(n){o&&o.d(n),n&&l(e),c&&c.d(n),n&&l(t)}}}function jn(n,e,t){let r=new $n,o=null,c=null;return{game:o,winner:c,newgame:function(){o&&o.free();const n=new vn,{subscribe:e,set:u}=Y(n.board()),{subscribe:s,set:i}=Y(n.valid_moves()),{subscribe:l,set:a}=Y(!1);function f(){const e=P(o.board);if(u(n.board()),e.free(),n.over()){const e=c=n.winner();return null===e?(t("winner",c="It's a tie!"),t("winner",c)):t("winner",c=0===e?"You win!":"You lose!"),console.log(c),a(!0),i([]),!0}}t("winner",c=null),t("game",o={board:{subscribe:e},moves:{subscribe:s},thinking:{subscribe:l},drop:e=>{if(console.log("dropped in column",e),n.drop(e),f())return;a(!0);const t=n.valid_moves();i(t),console.log(r.think(n,1e3));const o=r.move_weights(n.state(),t);console.log(o);let c=t.reduce((n,e,t)=>t==n||o[n]>o[t]?n:t,0);n.drop(t[c]),f()||(a(!1),i(n.valid_moves()))},free(){n.free(),P(o.board).free()}})},column_handler:function(n){return o.drop(n.detail)},click_handler:function(){const n=o=null;return t("game",o),n}}}class On extends T{constructor(n){super(),F(this,n,jn,En,u,[])}}function Nn(e){var t,r,o,c=e.err.message;return{c(){t=f("h1"),r=d("Error: "),o=d(c)},m(n,e){i(n,t,e),s(t,r),s(t,o)},p:n,i:n,o:n,d(n){n&&l(t)}}}function Cn(e){var t,r=new On({});return{c(){r.$$.fragment.c()},m(n,e){q(r,n,e),t=!0},p:n,i(n){t||(L(r.$$.fragment,n),t=!0)},o(n){M(r.$$.fragment,n),t=!1},d(n){z(r,n)}}}function Sn(e){var t;return{c(){(t=f("h1")).textContent="loading..."},m(n,e){i(n,t,e)},p:n,i:n,o:n,d(n){n&&l(t)}}}function Wn(n){var t,r,o;let c={ctx:n,current:null,token:null,pending:Sn,then:Cn,catch:Nn,value:"_",error:"err",blocks:[,,,]};return R(r=yn(),c),{c(){t=b(),c.block.c()},m(n,e){i(n,t,e),c.block.m(n,c.anchor=e),c.mount=(()=>t.parentNode),c.anchor=t,o=!0},p(t,o){n=o,c.ctx=n,r!==(r=yn())&&R(r,c)||c.block.p(t,e(e({},n),c.resolved))},i(n){o||(L(c.block),o=!0)},o(n){for(let n=0;n<3;n+=1){M(c.blocks[n])}o=!1},d(n){n&&l(t),c.block.d(n),c.token=null,c=null}}}return new class extends T{constructor(n){super(),F(this,n,null,Wn,u,[])}}({target:document.body})}();
//# sourceMappingURL=bundle.js.map
